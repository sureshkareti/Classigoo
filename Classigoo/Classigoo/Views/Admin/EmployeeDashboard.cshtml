@model IEnumerable<AdminAdd>
@{
    ViewBag.Title = "EmployeeDashboard";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    List<SelectListItem> statusCollection = new List<SelectListItem>();
    statusCollection.Add(new SelectListItem { Text = Constants.PendingSatus, Value = Constants.PendingSatus });
    statusCollection.Add(new SelectListItem { Text = Constants.ReviewSatus, Value = Constants.ReviewSatus });
    statusCollection.Add(new SelectListItem { Text = Constants.ActiveSatus, Value = Constants.ActiveSatus });
    statusCollection.Add(new SelectListItem { Text = Constants.DeactiveSatus, Value = Constants.DeactiveSatus });
    statusCollection.Add(new SelectListItem { Text = Constants.RejectSatus, Value = Constants.RejectSatus });


    List<SelectListItem> categoryCollection = new List<SelectListItem>();
    categoryCollection.Add(new SelectListItem { Text = Constants.AgriculturalVehicle, Value = Constants.AgriculturalVehicle });
    categoryCollection.Add(new SelectListItem { Text = Constants.ConstructionVehicle, Value = Constants.ConstructionVehicle });
    categoryCollection.Add(new SelectListItem { Text = Constants.PassengerVehicle, Value = Constants.PassengerVehicle });
    categoryCollection.Add(new SelectListItem { Text = Constants.RealEstate, Value = Constants.RealEstate });
    categoryCollection.Add(new SelectListItem { Text = Constants.TransportationVehicle, Value = Constants.TransportationVehicle });
}

<h2>EmployeeDashboard</h2>

@*<div class="row">

    <div class="col-sm-12">
        <div class="form-group row">         
            <div class="col-xl-1 col-md-6 pull-right">
                <a href="~/Post/Index" target="_blank" class="btn btn-sm btn-danger pull-right"  id="btnPostAdd">Post Add</a>
                
            </div>
        </div>

    </div>

</div>*@


<div class="row">

    <div class="col-sm-12">
        <div class="form-group row">
            <div class="col-xl-11 col-md-6 pull-right">
                <a href="~/Post/Index" target="_blank" class="btn btn-sm btn-danger pull-right" id="btnPostAdd">Post Add</a>
            </div>
            @*<div class="col-xl-1 col-md-6 pull-right">
                <input type="button" class="btn btn-sm btn-danger pull-right" value="Refresh" id="btnRefresh" />
            </div>*@
        </div>

    </div>

</div>

<div class="row">

    <div class="col-sm-12">



        <div class="row">


            <div class="col-xl-3 col-md-6">
                <div class="card-box widget-user" style="cursor:pointer" id="id1">
                    <div class="text-center">
                        <input type="text" class="form-control" id="txtAddidSearch" />
                        <h5>Add Id</h5>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="card-box widget-user">
                    <div class="text-center">
                        <input type="text" class="form-control" id="txtSubcategorySearch" />
                        <h5>Sub Category</h5>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="card-box widget-user">
                    <div class="text-center">

                        @Html.DropDownList("ddlCategorySearch", categoryCollection, "select", new { @class = "form-control" })

                        <h5>Category</h5>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6">
                <div class="card-box widget-user">
                    <div class="text-center">
                        @Html.DropDownList("ddlStatusSearch", statusCollection, "select", new { @class = "form-control" })
                        <h5>Status</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<div class="row">

    <div class="col-sm-12">

        <div class="row">
            <div class="col-12">
                <div class="card-box table-responsive">
                    <h4 class="m-t-0 header-title">Adds</h4>
                    <p class="text-muted font-14 m-b-30">
                        following are the adds which are <code> submitted by Employees</code>.
                    </p>
                    <table id="tblAdds" class="table table-striped table-bordered nowrap display responsive" style="width:100%">
                        <thead>
                            <tr>
                                <th></th>
                                <th data-class="expand">AddId</th>
                                <th data-class="expand">AddId</th>
                                <th data-hide="phone">Date and Time</th>
                                <th data-hide="phone">Sub Category</th>
                                <th data-hide="phone">Rent/Sale</th>
                                <th>Preview</th>
                                <th>Edit</th>
                                <th>Status</th>
                                <th data-hide="phone">User Name</th>
                                <th data-hide="phone">Mobile No</th>
                                <th data-hide="phone">Category</th>
                                <th data-hide="phone">State</th>
                                <th data-hide="phone">District</th>
                                <th data-hide="phone">Mandal</th>
                                <th>Remarks</th>
                                <th>Status</th>
                                <th>Action</th>
                                @*<th>Delete</th>*@
                                <th>User Name</th>
                                <th>Mobile No</th>
                            </tr>

                        </thead>

                        <tbody>
                            @foreach (var item in Model)
                            {

                                <tr>
                                    @*<td>@item.PhoneNum</td>*@
                                    <td></td>
                                    <td>
                                        @item.AddId
                                    </td>
                                    <td id="addId">
                                        @item.AddId
                                    </td>
                                    <td>
                                        @item.Created
                                    </td>
                                    <td>
                                        @item.SubCategory
                                    </td>
                                    <td>
                                        @item.Type
                                    </td>

                                    <td>
                                        @Html.ActionLink("Preview", "PreviewAdd", "List", new { addId = @item.AddId }, new { target = "_blank", style = "color:#337ab7;" })

                                    </td>
                                    <td>
                                        @Html.ActionLink("Edit", "Index", "Post", new { addId = @item.AddId }, new { target = "_blank", style = "color:#337ab7;" })
                                    </td>


                                    <td>
                                        <span> <label id="lblStatus">@item.Status</label></span>


                                    </td>
                                    <td>
                                        @item.UserName
                                    </td>
                                    <td>
                                        @item.PhoneNum
                                    </td>


                                    <td>
                                        @item.Category
                                    </td>
                                    <td>
                                        @item.State
                                    </td>
                                    <td>
                                        @item.District
                                    </td>
                                    <td>
                                        @item.Mandal
                                    </td>


                                    <td>
                                        <span class="display-mode"> <label id="lblRemarks">@item.Remarks</label></span>
                                        @Html.TextArea("txtRemarks", item.Remarks, new { @class = "edit-mode", @maxlength = "1000", @style = "@width=350px;@height=80px" })
                                    </td>
                                    <td>
                                        <span class="display-mode"> <label id="lblAddStatus">@item.Status</label></span>
                                        @Html.DropDownList("ddlStatus", statusCollection, new { @class = "edit-mode" })
                                    </td>
                                    <td>
                                        <input type="button" value="Edit" class="edit-user display-mode" style="color:#337ab7;" onclick="FnEditCancel(event);" />
                                        <input type="button" class="save-user edit-mode" style="color:#337ab7;" value="Save" onclick="FnSave(event)" />
                                        <input type="button" class="cancel-user edit-mode" style="color:#337ab7;" value="Cancel" onclick="FnEditCancel(event);" />
                                    </td>
                                    @*<td>
                                        @Html.ActionLink("Delete", "Delete", "Post", new { addId = @item.AddId }, new { target = "", style = "color:#337ab7;" })
                                    </td>*@
                                    <td>
                                        <span id="userName" class="UserInfo">@item.UserName</span>
                                    </td>
                                    <td>
                                        <span id="userPhoneNum" class="UserInfo">@item.PhoneNum</span>
                                    </td>
                                </tr>

                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div> <!-- end row -->
    </div>

</div>

<!--  Modal content for the above example -->
@*<div id="myModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg" style="max-width:1000px;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title mt-0" id="myLargeModalLabel">Send SMS</h3>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">

                <div class="col-md-12">
                    <div>
                        <h4 class="m-t-0 m-b-30 header-title">Send Message</h4>

                        <div id="divFormFields">

                            <div class="form-group row">
                                <label for="inputPassword3" class="col-2 col-form-label">Add Id's</label>
                                <div class="col-8">
                                    <div class="tags-default">
                                        <input type="text" id="txtMobileNumbers" data-role="tagsinput" placeholder="add addids" />
                                    </div>
                                </div>
                                <div class="col-2">

                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="inputPassword3" class="col-2 col-form-label">Message</label>
                                <div class="col-8">
                                    <textarea class="form-control" id="txtMessage" rows="5"></textarea>
                                </div>
                                <div class="col-2">

                                </div>
                            </div>
                        </div>

                        <div class="form-group mb-0 justify-content-end row">

                            <div class="col-8">
                                <button type="button" id="btnSendSMSFromModal" class="btn btn-info waves-effect waves-light">Send SMS</button>
                            </div>
                            <div class="col-2">

                            </div>
                        </div>

                    </div>
                </div>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">close</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>*@<!-- /.modal -->



@section Styles {
    <!-- DataTables -->
    @*<link href="~/Content/List/responsive.bootstrap.min.css" rel="stylesheet" />*@
    <link href="~/Content/Admin/assets/plugins/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/Admin/assets/plugins/datatables/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    @*<link href="https://cdn.datatables.net/responsive/1.0.7/css/responsive.dataTables.min.css" rel="stylesheet" type="text/css" />*@
    <link href="~/Content/Admin/assets/plugins/datatables/responsive.bootstrap4.min.css" rel="stylesheet" />
    <link href="~/Content/Admin/assets/plugins/bootstrap-tagsinput/dist/bootstrap-tagsinput.css" rel="stylesheet" />
@*<link href="~/Content/List/color1.css" rel="stylesheet" />*@
    @*<link href="~/Content/Admin/assets/plugins/datatables/select.bootstrap4.min.css" rel="stylesheet" />*@
    <link type="text/css" href="//gyrocode.github.io/jquery-datatables-checkboxes/1.2.11/css/dataTables.checkboxes.css" rel="stylesheet" />

    <!-- Notification css (Toastr) -->
    <link href="~/Content/Admin/assets/plugins/toastr/toastr.min.css" rel="stylesheet" type="text/css" />
}

@section scripts {

    <!-- Required datatable js -->

    <script src="~/Content/Admin/assets/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/Content/Admin/assets/plugins/datatables/dataTables.bootstrap4.min.js"></script>
    @*<script type="text/javascript" src="https://cdn.datatables.net/responsive/1.0.7/js/dataTables.responsive.min.js"></script>*@
    <script src="~/Content/Admin/assets/plugins/datatables/responsive.bootstrap4.min.js"></script>
    <script src="~/Content/Admin/assets/plugins/datatables/dataTables.responsive.min.js"></script>
    @*<script src="~/Content/Admin/assets/plugins/datatables/dataTables.select.min.js"></script>*@

    <script src="~/Content/Admin/assets/plugins/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js"></script>


    <script type="text/javascript" src="//gyrocode.github.io/jquery-datatables-checkboxes/1.2.11/js/dataTables.checkboxes.min.js"></script>

    <!-- Toastr js -->
    <script src="~/Content/Admin/assets/plugins/toastr/toastr.min.js"></script>

    <script type="text/javascript">

        var toastCount = 0;
        function FnEditCancel(e) {
            var editElemts = e.srcElement.offsetParent.getElementsByClassName('edit-mode');
            var displayElemts = e.srcElement.offsetParent.getElementsByClassName('display-mode');
            $(editElemts).each(function (index) {
                $(this).toggle();
            });
            $(displayElemts).each(function (index) {
                $(this).toggle();
            });
        }

        function FnSave(e) {
            $(".loader-wrap").show();
            var editElemts = e.srcElement.offsetParent.getElementsByClassName('edit-mode');
            var displayElemts = e.srcElement.offsetParent.getElementsByClassName('display-mode');
            var status = editElemts.ddlStatus.value;
            var remarks = editElemts.txtRemarks.value
            var addId = e.srcElement.offsetParent.parentElement.previousElementSibling.children.addId.innerText;
            var userElemts = e.srcElement.offsetParent.getElementsByClassName('UserInfo');
            var userName = userElemts.userName.innerText;
            var userPhoneNum = userElemts.userPhoneNum.innerText;
            $.ajax({
                url: '/User/UpdateAddStatus/',
                data: { addId: addId, status: status, remarks: remarks, userName: userName, userPhoneNum: userPhoneNum },
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                success: function (data) {

                    window.location.href = "/Admin/EmployeeDashboard";
                    $(".loader-wrap").hide();

                },
                failure: function (response) {
                    console.log(response.responseText);
                },
                error: function (response) {
                    console.log(response.responseText);
                }
            });

        }
        $(document).ready(function () {

            $('.edit-mode').hide();
            var table = $('#tblAdds').DataTable({
                "responsive": true,
                "pageLength": 40,
                stateSave: true,
                columnDefs: [
                                {
                                    targets: 1,
                                    checkboxes: {
                                        selectRow: true
                                    },

                                },
                               {
                                   targets: 0,
                                   orderable: false

                               }

                ],
                select: {
                    style: 'multi'
                }
                ,
                order: [[2, 'asc']],
                initComplete: function () {
                    this.api().columns([2, 3, 6]).every(function () {
                        var column = this;
                        var select = $('<select><option value=""></option></select>')
                            .appendTo($(column.footer()).empty())
                            .on('change', function () {
                                var val = $.fn.dataTable.util.escapeRegex(
                                    $(this).val()
                                );

                                column
                                    .search(val ? '^' + val + '$' : '', true, false)
                                    .draw();
                            });

                        column.data().unique().sort().each(function (d, j) {
                            // select.append('<option value="' + d + '">' + d + '</option>')
                            var val = $('<div/>').html(d).text();
                            select.append('<option value="' + val + '">' + val + '</option>');
                        });
                    });
                }

            });


            $('#txtAddidSearch').on('keyup', function () {
                table
                    .columns(2)
                    .search(this.value)
                    .draw();
            });
            $('#txtSubcategorySearch').on('keyup', function () {
                table
                    .columns(4)
                    .search(this.value)
                    .draw();
            });
            $('#ddlCategorySearch').on('change', function () {
                table
                      .columns(11)
                      .search(this.value)
                      .draw();
            });
            $('#ddlStatusSearch').on('change', function () {
                table
                      .columns(8)
                      .search(this.value)
                      .draw();
            });
            $("#btnRefresh").on('click', function () {
                table.state.clear();
                window.location.reload();
            });

            $("#btnSendSms").on('click', function () {


                // Handle form submission event
                var rows_selected = table.column(1).checkboxes.selected();

                var selectedNumbers = '';
                // Iterate over all selected checkboxes
                $.each(rows_selected, function (index, rowId) {
                    selectedNumbers += rowId + ',';
                });

                $("#txtMobileNumbers").tagsinput('add', selectedNumbers);

                $("#myModal").modal("show");
            });

            $("#btnSendSMSFromModal").on('click', function () {
                console.log($("#txtMobileNumbers").val());

                ShowSucessToaster("Sucessfully Created !!!!", 'success');

                ShowSucessToaster("There is problem while Creating Task Try again !!!!", 'error');

            });

        });


        function ShowSucessToaster(message, state) {

            var shortCutFunction = state;
            var msg = message;
            var title = 'Status';
            var showDuration = "300";
            var hideDuration = "1000";
            var timeOut = "5000";
            var extendedTimeOut = "1000";
            var showEasing = "swing";
            var hideEasing = "linear";
            var showMethod = "fadeIn";
            var hideMethod = "fadeOut";
            var toastIndex = toastCount++;
            var addClear = $('#addClear').prop('checked');

            toastr.options = {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": false,
                "positionClass": "toast-top-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };

            if ($('#addBehaviorOnToastClick').prop('checked')) {
                toastr.options.onclick = function () {
                    alert('You can perform some custom action after a toast goes away');
                };
            }

            if (showDuration.length) {
                toastr.options.showDuration = showDuration;
            }

            if (hideDuration.length) {
                toastr.options.hideDuration = hideDuration;
            }

            if (timeOut.length) {
                toastr.options.timeOut = addClear ? 0 : timeOut;
            }

            if (extendedTimeOut.length) {
                toastr.options.extendedTimeOut = addClear ? 0 : extendedTimeOut;
            }

            if (showEasing.length) {
                toastr.options.showEasing = showEasing;
            }

            if (hideEasing.length) {
                toastr.options.hideEasing = hideEasing;
            }

            if (showMethod.length) {
                toastr.options.showMethod = showMethod;
            }

            if (hideMethod.length) {
                toastr.options.hideMethod = hideMethod;
            }

            if (addClear) {
                msg = getMessageWithClearButton(msg);
                toastr.options.tapToDismiss = false;
            }
            if (!msg) {
                msg = getMessage();
            }

            $('#toastrOptions').text('Command: toastr["'
                + shortCutFunction
                + '"]("'
                + msg
                + (title ? '", "' + title : '')
                + '")\n\ntoastr.options = '
                + JSON.stringify(toastr.options, null, 2)
            );

            var $toast = toastr[shortCutFunction](msg, title); // Wire up an event handler to a button in the toast, if it exists
            $toastlast = $toast;

            if (typeof $toast === 'undefined') {
                return;
            }

            if ($toast.find('#okBtn').length) {
                $toast.delegate('#okBtn', 'click', function () {
                    alert('you clicked me. i was toast #' + toastIndex + '. goodbye!');
                    $toast.remove();
                });
            }
            if ($toast.find('#surpriseBtn').length) {
                $toast.delegate('#surpriseBtn', 'click', function () {
                    alert('Surprise! you clicked me. i was toast #' + toastIndex + '. You could perform an action here.');
                });
            }
            if ($toast.find('.clear').length) {
                $toast.delegate('.clear', 'click', function () {
                    toastr.clear($toast, { force: true });
                });
            }



        }




    </script>

    }
