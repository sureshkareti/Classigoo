@model CustomHomeModel
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    string emailPattern = @"[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$";
}
@using (Html.BeginForm("Home", "User", FormMethod.Post))
{
    <div>
        @*<div class="breadcrumb-block">

            </div>*@

        <div class="row loginform" style="max-width:970px !important;margin:auto;padding:30px;">
            <div class="col-md-5">
                <span style="color:#2B2B2B;font-weight:200;font-size:20px">Your Classigoo Ads</span><br />

               
                <span style="font-size:13px;color:#a5a5a5;font-weight:200;">@ViewBag.status</span>
            </div>
            <div class="col-md-4">

            </div>
            @*<div class="col-md-3 account-balance">
                    <div style="height:60px;width:100%;border:1px solid #dedede;border-radius:5px;">
                        <span style="font-size:13px;color:#a5a5a5;font-weight:200;padding-left:15px;"> Account balance</span>
                        <ul>
                            <li class="dropdown">
                                <a href="#" data-toggle="dropdown" class="dropdown-toggle" style="font-size:24px;padding-left:15px"> <span class="fa fa-rupee" style="font-size:20px"></span>&nbsp; 0  <b class="caret"></b></a>
                                <ul class="dropdown-menu" style="padding:0;">
                                    <li><a href="#" style="color:#a5a5a5;">Credits: <span class="fa fa-rupee"></span> 0</a></li>
                                    <li class="divider"></li>
                                    <li><a href="#" style="color:#a5a5a5;">Bonus Credits: 0 pts</a></li>
                                </ul>
                            </li>
                        </ul>


                    </div>
                </div>*@
        </div>
        <div class="row" style="max-width:970px !important;margin:auto;padding:0 30px 30px 30px;">

            <div class="col-md-12">
                <div class="panel with-nav-tabs panel-default">
                    <div class="panel-heading">
                        <ul class="nav nav-tabs" id="parentTab">
                            <li class="active"><a href="#tab1default" data-toggle="tab" id="tab1Ads">Ads</a></li>
                            <li><a href="#tab2default" data-toggle="tab" id="tab2Messages">Messages</a></li>
                            <li><a href="#tab3default" data-toggle="tab" id="tab3Payments">Payments</a></li>
                            <li><a href="#tab4default" data-toggle="tab" id="tab4Settings">Settings</a></li>
                        </ul>
                    </div>
                    <div class="panel-body">
                        <div class="tab-content">
                            <div class="tab-pane fade in active" id="tab1default">

                                <div class="clearfix"></div>
                                <div class="row">
                                    @*<div class="col-md-8">Active (1)</div>
                                        <div class="col-md-4">

                                            <div id="custom-search-input">
                                                <div class="input-group col-md-12">
                                                    <input type="text" class="form-control " placeholder="Buscar" />
                                                    <span class="input-group-btn">
                                                        <button class="btn btn-info " type="button">
                                                            <i class="glyphicon glyphicon-search"></i>
                                                        </button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>*@
                                </div>
                                @*<hr />*@
                                <div class="row" style="min-height:150px;text-align:center">

                                    <table id="tblAdds" class="table table-striped table-bordered nowrap" style="width:100%">
                                        <thead>
                                            <tr>
                                                <th data-class="expand">AddId</th>
                                                <th data-hide="phone">CreatedDate</th>
                                                <th data-hide="phone">Title</th>
                                                <th data-hide="phone">price</th>
                                                <th data-hide="phone">status</th>
                                                <th data-hide="phone">image</th>
                                                <th>preview</th>
                                                <th>Edit</th>
                                                <th>Delete</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in Model.AddColl)
                                            {

                                            <tr>
                                                <td id="addId">
                                                    @item.AddId
                                                </td>
                                                <td>
                                                    @item.CreatedDate
                                                </td>
                                                <td>
                                                    @item.Title
                                                </td>
                                                <td>
                                                    @item.Price
                                                </td>
                                                <td>
                                                    @item.Status
                                                </td>
                                                <td>
                                                    <img src="@item.ImgUrlPrimary" class="list_thumbnail fleft" width="50" />
                                                </td>
                                                <td>
                                                    @Html.ActionLink("Preview", "PreviewAdd", "List", new { addId = @item.AddId }, new { target = "_blank" })

                                                </td>
                                                <td>
                                                    @Html.ActionLink("Edit", "Index", "Post", new { addId = @item.AddId }, new { target = "_blank" })
                                                </td>
                                                <td>
                                                    @Html.ActionLink("Delete", "Delete", "Post", new { addId = @item.AddId }, new { target = "" })
                                                </td>

                                            </tr>

                                            }
                                        </tbody>
                                        <tfoot>

                                        </tfoot>
                                    </table>
                                    @*<p>No Messages are </p>*@
                                </div>

                            </div>
                            <div class="tab-pane fade" id="tab2default">
                                <div class="clearfix"></div>

                                <!-- BEGIN Portlet PORTLET-->
                                <div class="portlet">
                                    <div class="col-md-8">
                                        <div class="portlet-title">
                                            <ul class="nav nav-tabs" id="chaildChat">
                                                <li class="active" id="mainChat">
                                                    <a href="#portlet_Inbox" data-toggle="tab" style="background-color:white">
                                                        Inbox
                                                    </a>
                                                </li>
                                                <li  id="detailedChat" >
                                                    <a href="#portlet_Sent" data-toggle="tab" style="background-color:white">
                                                        Chat
                                                    </a>
                                                </li>
                                                @*<li>
                                                        <a href="#portlet_archive" data-toggle="tab" style="background-color:white">
                                                            Archive
                                                        </a>
                                                    </li>*@

                                            </ul>
                                        </div>
                                    </div>
                                    @*<div class="col-md-4">
                                            <div id="custom-search-input">
                                                <div class="input-group col-md-12">
                                                    <input type="text" class="form-control " placeholder="Buscar" />
                                                    <span class="input-group-btn">
                                                        <button class="btn btn-info " type="button">
                                                            <i class="glyphicon glyphicon-search"></i>
                                                        </button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>*@


                                    <div class="portlet-body">
                                        <div class="tab-content" style="min-height:400px;" id="chatContent">
                                            <div class="tab-pane active" id="portlet_Inbox" style="text-align:center">

                                                <div class="row" style="padding-top:30px;display:block">

                                                    <div class="col-md-12" style="height:20px;width:100%;">
                                                        <div class="row">
                                                            <div class="col-md-1">
                                                                delete
                                                            </div>
                                                            <div class="col-md-4" style="vertical-align:middle;display:table-cell">
                                                                User
                                                            </div>
                                                            <div class="col-md-5">
                                                                Add
                                                            </div>
                                                            <div class="col-md-2">
                                                                Date
                                                            </div>
                                                        </div>
                                                    </div>


                                                    @foreach (var chat in Model.ChatColl)
                                                    {
                                                    <div class="col-md-12 message">
                                                        <div class="row">
                                                            <div class="col-md-1">
                                                                <a href="#" style="font-size:24px;"> <span><i class="fa fa-trash"></i></span></a>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <span><i class="fa fa-angle-right"></i> @chat.FromUserName,<span style="max-width:80px;white-space: nowrap; overflow: hidden;text-overflow: ellipsis;display:inline-flex">@chat.ToUserName</span> ..(23) </span>
                                                            </div>
                                                            <div class="col-md-5">

                                                                <span style="width:200px;white-space:nowrap; overflow:hidden;text-overflow:ellipsis;display:inline-block;text-align:center">
                                                                    @chat.AddTitle
                                                                </span>
                                                            </div>
                                                            <div class="col-md-2">
                                                                @chat.MessageSentDate
                                                            </div>
                                                        </div>
                                                        <input type="hidden" value="@chat.FromUserId" id="hdnFromUserId" />
                                                        <input type="hidden" value="@chat.ToUserId" id="hdnToUserId" />
                                                        <input type="hidden" value="@chat.AddId" id="hdnAddId" />
                                                        <input type="hidden" value="@chat.RequestorUserId" id="hdnRequestorUserId" />
                                                    </div>
                                                    }
                                                </div>



                                                @*<div class="row" style="min-height:150px;text-align:center;padding-top:80px;display:none">
                                                        @foreach (var chat in Model.ChatColl)
                                                        {
                                                            <span>@chat.Msg.AdId</span>
                                                            <span>@chat.FromUserName</span>
                                                            <span>@chat.ToUserName</span>
                                                            <a id="loadChat" href="#" onClick="LoadChat()">@chat.AddTitle</a>
                                                            @Html.ActionLink(@chat.AddTitle, "LoadChat", new {addId=chat.Msg.AdId })
                                                            <span>@chat.Msg.Message1</span>
                                                            <span>@chat.Msg.CreatedOn</span>
                                                            <br />
                                                        }

                                                    </div>*@

                                            </div>
                                            <div class="tab-pane" id="portlet_Sent" style="padding:10px;">


                                                <div class="row" id="individualChat" style="padding-top:30px;display:block">


                                                </div>

                                                @*<div id="loadChat" class="row" style="min-height:150px;text-align:center;padding-top:80px">


                                                    </div>*@
                                            </div>
                                            @* <div class="tab-pane" id="portlet_archive">

                                                    <div class="row" style="min-height:150px;text-align:center;padding-top:80px">
                                                        <p>No Messages.</p>
                                                    </div>
                                                </div>*@

                                        </div>
                                    </div>
                                </div>
                                <!-- END Portlet PORTLET-->
                            </div>
                            <div class="tab-pane fade" id="tab3default" style="background: #f1f3fa;">
                                <div class="clearfix"></div>

                                <!-- BEGIN Portlet PORTLET-->
                                <div class="portlet">
                                    <div class="portlet-title">
                                        @*<div class="caption caption-red">
                                                <i class="glyphicon glyphicon-pushpin"></i>
                                                <span class="caption-subject bold font-yellow-crusta uppercase">
                                                    Tabs
                                                </span>
                                                <span class="caption-helper">more samples...</span>
                                            </div>*@
                                        <ul class="nav nav-tabs">
                                            <li class="active">
                                                <a href="#portlet_History" data-toggle="tab" style="background-color:white">
                                                    History
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#portlet_invoices" data-toggle="tab" style="background-color:white">
                                                    E-invoices
                                                </a>
                                            </li>

                                        </ul>
                                    </div>
                                    <div class="portlet-body">
                                        <div class="tab-content">
                                            <div class="tab-pane active" id="portlet_History">
                                                @*<div class="row">
                                                        <div class="col-md-8"></div>
                                                        <div class="col-md-4">

                                                            <div id="custom-search-input">
                                                                <div class="input-group col-md-12">
                                                                    <input type="text" class="form-control " placeholder="Buscar" />
                                                                    <span class="input-group-btn">
                                                                        <button class="btn btn-info " type="button">
                                                                            <i class="glyphicon glyphicon-search"></i>
                                                                        </button>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>*@

                                                <div class="row" style="min-height:150px;text-align:center;padding-top:80px">
                                                    <p>Empty payment history.</p>
                                                </div>

                                            </div>
                                            <div class="tab-pane" id="portlet_invoices">

                                                <div class="row" style="min-height:150px;text-align:center;padding-top:80px">
                                                    <p>No e-invoice/receipt available</p>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <!-- END Portlet PORTLET-->
                            </div>
                            <div class="tab-pane fade" id="tab4default">
                                <div class="clearfix"></div>
                                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                                    @*<div class="panel panel-default accordion-header">
                                            <div class="panel-heading" role="tab" id="headingOne">
                                                <h4 class="panel-title">
                                                    <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                                        Change contact details
                                                    </a>
                                                </h4>
                                            </div>
                                            <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                                                <div class="panel-body">
                                                    <div class="row  form-group">
                                                        <div class="col-md-4">
                                                            <span>State</span>
                                                            <select id="SubjectList" name="SubjectList" class="form-control">
                                                                <option value="1">Choose</option>
                                                                <option value="2">City2</option>
                                                                <option value="3">City3</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="row  form-group">
                                                        <div class="col-md-4">
                                                            <span>City</span>
                                                            <select id="SubjectList1" name="SubjectList1" class="form-control">
                                                                <option value="1">Choose</option>
                                                                <option value="2">City2</option>
                                                                <option value="3">City3</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="row  form-group">
                                                        <div class="col-md-4">
                                                            <span>Name<span style="color:red">*</span></span>
                                                            <input type="password" class="form-control" name="txtName" required="required" data-error="This field is required." />
                                                        </div>
                                                    </div>
                                                    <div class="row  form-group">
                                                        <div class="col-md-4">
                                                            <input type="button" class="btn btn-primary" value="Change Password" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>*@
                                    <div class="panel panel-default accordion-header">

                                        <div class="panel-heading" role="tab" id="headingTwo">
                                            <h4 class="panel-title">
                                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                                    Change phone
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                                            <div class="panel-body">
                                                @using (Html.BeginForm("Home", "User", FormMethod.Post, new { id = "frmChangePhone" }))
                                                {
                                                @Html.Hidden("IsPwdEmpty", (bool)ViewBag.IsPwdEmpty)

                                                <div class="row  form-group">
                                                    <div class="col-md-4">
                                                        <span>New Phone Number<span style="color:red">*</span></span>

                                                        <div class="input-group">
                                                            <span class="input-group-addon">+91</span>
                                                            <input id="inputPhone" type="text" class="form-control" name="txtPhone" required="required" pattern="^\d{10}$" oninvalid="this.setCustomValidity('Please enter a valid 10 digit Phone Number.')"
                                                                   oninput="setCustomValidity('')">
                                                            <div class="help-block with-errors"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row  form-group">
                                                    <div class="col-md-4">
                                                        <input type="submit" class="btn btn-primary" value="Change Phone" name="action" />
                                                    </div>
                                                </div>
                                                }

                                            </div>
                                        </div>

                                    </div>
                                    <div class="panel panel-default accordion-header">
                                        <div class="panel-heading" role="tab" id="headingThree">
                                            <h4 class="panel-title">
                                                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                                    @if (ViewBag.IsPwdEmpty)
                                                    {
                                                    <span>Create password</span>
                                                    }
                                                    else
                                                    {
                                                    <span>Change password</span>
                                                    }
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                                            <div class="panel-body">
                                                @using (Html.BeginForm("Home", "User", FormMethod.Post, new { id = "frmChangePassword" }))
                                                {
                                                @Html.Hidden("IsPwdEmpty", (bool)ViewBag.IsPwdEmpty)
                                                    if (!ViewBag.IsPwdEmpty)
                                                    {
                                                <div class="row  form-group">
                                                    <div class="col-md-4">
                                                        <span>Old Password<span style="color:red">*</span></span>
                                                        <input type="password" name="txtOldPasscode" class="form-control" required="required" minlength="5" data-error="This field is required." />
                                                    </div>
                                                </div>
                                                    }
                                                <div class="row  form-group">
                                                    <div class="col-md-4">
                                                        <span>New Password<span style="color:red">*</span></span>
                                                        <input type="password" name="txtPasscode" class="form-control" required="required" minlength="5" data-error="This field is required." />
                                                    </div>
                                                </div>
                                                <div class="row  form-group">
                                                    <div class="col-md-4">
                                                        <span>Repeat new password<span style="color:red">*</span></span>
                                                        <input type="password" class="form-control" name="txtConfirmPasscode" required="required" data-error="This field is required." />
                                                    </div>
                                                </div>
                                                <div class="row  form-group">
                                                    <div class="col-md-4">
                                                        @if (ViewBag.IsPwdEmpty)
                                                            {
                                                            <input type="submit" class="btn btn-primary" value="Create Password" name="action" />
                                                            }
                                                            else
                                                            {

                                                            <input type="submit" class="btn btn-primary" value="Change Password" name="action" />
                                                            }

                                                    </div>
                                                </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                    @*<div class="panel panel-default accordion-header">

                                            <div class="panel-heading" role="tab" id="headingFour">
                                                <h4 class="panel-title">
                                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseThree">

                                                        Change email
                                                    </a>
                                                </h4>
                                            </div>
                                            <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
                                                <div class="panel-body">
                                                    @using (Html.BeginForm("Home", "User", FormMethod.Post))
                                                    {
                                                        @Html.Hidden("IsPwdEmpty", (bool)ViewBag.IsPwdEmpty )
                                                <div class="row  form-group">
                                                    <div class="col-md-4">
                                                        <span>New email<span style="color:red">*</span></span>

                                                        <input type="text" class="form-control" name="txtEmail" required pattern="@emailPattern" oninvalid="this.setCustomValidity('Please enter a valid Email address.')"
                                                               oninput="setCustomValidity('')" />
                                                    </div>
                                                </div>
                                                <div class="row  form-group">
                                                    <div class="col-md-4">
                                                        <input type="submit" class="btn btn-primary" value="Change Email" name="action" />
                                                    </div>
                                                </div>
                                                }
                                                </div>
                                            </div>

                                        </div>*@
                                    @*<div class="panel panel-default accordion-header">
                                            <div class="panel-heading" role="tab" id="headingFive">
                                                <h4 class="panel-title">
                                                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapseThree">
                                                        Delete account
                                                    </a>
                                                </h4>
                                            </div>
                                            <div id="collapseFive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFive">
                                                <div class="panel-body">

                                                    <div class="row">
                                                        <div class="col-md-12" style="text-align:center;">
                                                            <input type="button" class="btn btn-danger" value="delete" />
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>*@
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            @*https://codepen.io/Sp00ky/pen/zBZZvq*@

        </div>

    </div>
    <br />
    <br />
    <div class="loader-wrap" style="display:none">
        <div class="loader">
            <span class="loader-item"></span><span class="loader-item"></span><span class="loader-item"></span><span class="loader-item"></span><span class="loader-item"></span><span class="loader-item"></span><span class="loader-item"></span><span class="loader-item"></span>
            <span class="loader-item"></span><span class="loader-item"></span>
        </div>
    </div>
}

@section Styles {
    <link href="@Url.Content("~/Content/Custome/account.css")" rel="stylesheet" type="text/css" />
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/bootstrapValidator.min.css" rel="stylesheet" />
    <link href="~/Content/List/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/List/responsive.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/List/color1.css" rel="stylesheet" />
}

@section Scripts{
    <script src="~/scripts/bootstrapValidator.min.js"></script>
    <script src="~/scripts/Custome/account.js"></script>
    <script src="~/Scripts/List/dataTables.min.js"></script>
    <script src="~/Scripts/List/bootstrap.min.js"></script>
    <script src="~/Scripts/List/responsive.min.js"></script>
    <script src="~/Scripts/List/responsive.bootstrap.min.js"></script>
}

<style type="text/css">
    .message {
        min-height: 50px;
        width: 100%;
        border: 1px solid #fafafa;
        font-size: 14px;
        padding-top: 10px;
        background-color: #fafafa;
        margin: 5px 0 5px 0;
        cursor: pointer;
    }
</style>

<script>
    $(document).ready(function () {


       

        $('#parentTab a[data-toggle="tab"]').on('show.bs.tab', function (e) {
            localStorage.setItem('activeTab', $(e.target).attr('href'));
        });

        $('#chaildChat a[data-toggle="tab"]').on('show.bs.tab', function (e) {
            
            localStorage.setItem('activeTabC', $(e.target).attr('href'));
        });


        var activeTab = localStorage.getItem('activeTab');
        var activeTabC = localStorage.getItem('activeTabC');

        if (activeTab) {
            $('#parentTab a[href="' + activeTab + '"]').tab('show');
        }

        if (activeTabC) {
            $('#chaildChat a[href="' + activeTabC + '"]').tab('show');
        }


        var addid = localStorage.getItem('localAddId');
        var requestorId = localStorage.getItem('localRequestorId');

    
        if ((addid != null) && (requestorId != null)) {
            LoadChat(addid, requestorId);
        }
        

        $('.edit-mode').hide();
        var table = $('#tblAdds').DataTable({
            "responsive": true
        });

        $(".message").click(function () {
            var addId = $(this).find("#hdnAddId").val();
            var requestorUserId = $(this).find("#hdnRequestorUserId").val();
            $(".loader-wrap").show();


            localStorage.setItem('localAddId', addId);
            localStorage.setItem('localRequestorId', requestorUserId);

            LoadChat(addId, requestorUserId);
        });
        
        $("#tab1Ads").click(function () {
          
            window.location.reload(true);
        });
        $("#tab2Messages").click(function () {

            window.location.reload(true);
        });
        
    });

   

    function LoadChat(addId, requestorUserId) {
        $.ajax({
            url: '/User/LoadChat',
            type: 'GET',
            dataType: "html",
            data: { "addId": addId, "requestorUserId": requestorUserId },
            success: function (data) {

                $("#mainChat").removeClass("active");
                $("#detailedChat").addClass("active");

                $("#chatContent #portlet_Inbox").removeClass("active");
                $("#chatContent #portlet_Sent").addClass("active");

                localStorage.setItem('activeTabC','#portlet_Sent');

                $("#individualChat").html(data);
                $(".loader-wrap").hide();
            },
            failure: function (response) {
                console.log(response.responseText);
                $(".loader-wrap").hide();
            },
            error: function (response) {
                console.log(response.responseText);
                $(".loader-wrap").hide();
            },
            complete: function (data) {

            }

        });
    }
</script>